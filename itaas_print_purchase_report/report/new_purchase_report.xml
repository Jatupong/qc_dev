<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template
            id="new_purchase_report"
            inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//div/div[4]" position="replace">

            <strong>Delivery Date:</strong><br/>
            <!--            <span class="m-0" t-field="o.date_deliver"/>-->
            <t t-if="o.date_deliver">
                <span t-esc="datetime.datetime.strptime(str(o.date_deliver), '%Y-%m-%d %H:%M:%S').strftime('%d/%m/%Y')"/>
            </t>
        </xpath>

        <xpath expr="//div/table/thead" position="replace">
            <tr>
                <th name="th_no"><strong>NO.</strong></th>
                <th name="th_description"><strong>Description</strong></th>
                <!--                <th name="th_taxes"><strong>Taxes</strong></th>-->
                <th name="th_date_deliver"><strong>Delivery Date</strong></th>
                <!--<th name="th_date_req" class="text-center"><strong>Date Req.</strong></th>-->
                <th name="th_quantity" class="text-right"><strong>Qty</strong></th>
                <th name="th_unit"><strong>Unit</strong></th>
                <th name="th_price_unit" class="text-right"><strong>Unit Price</strong></th>
                <th name="th_discount" class="text-right"><strong>Discount</strong></th>

                <th name="th_amount" class="text-right"><strong>Amount</strong></th>
            </tr>
        </xpath>
        <xpath expr="//div/table/tbody" position="replace">

            <t t-set="current_subtotal" t-value="0"/>
            <t t-foreach="o.order_line" t-as="line">
                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                    <t t-if="not line.display_type">
                        <td id="no">
                            <span t-field="line.number"/>
                        </td>

                        <td id="product">
                            <span t-field="line.name"/>
                        </td>
                        <!--                        <td name="td_taxes">-->
                        <!--                            <span t-esc="', '.join(map(lambda x: x.name, line.taxes_id))"/>-->
                        <!--                        </td>-->
                        <td name="th_date_deliver">
                            <!--                            <span t-field="line.date_planned"/>-->
                            <span t-esc="datetime.datetime.strptime(str(line.date_planned), '%Y-%m-%d %H:%M:%S').strftime('%d/%m/%Y')"/>
                        </td>
                        <!--<td class="text-center">-->
                        <!--    <span t-field="line.date_planned"/>-->
                        <!--</td>-->
                        <td class="text-right">
                            <!--<span t-field="line.product_qty"/>-->
                            <!--<span t-field="line.product_uom.name" groups="uom.group_uom"/>-->
                            <span t-esc="'{0:,.2f}'.format(float(line.product_qty))"/>
                        </td>

                        <td id="text-right">
                            <span t-field="line.product_uom"/>
                        </td>
                        <td class="text-right">
                            <!--<span t-field="line.price_unit"/>-->
                            <span t-esc="'{0:,.2f}'.format(float(line.price_unit))"/>
                        </td>
                        <!--                        <td align="right">-->
                        <!--                            &lt;!&ndash;<span t-field="line.discount"/>&ndash;&gt;-->
                        <!--                            <span t-esc="'{0:,.1f}'.format(float(line.discount))"/>-->
                        <!--                        </td>-->

                        <td align="right">
                            <t t-if="line.product_id">
                                <t t-if="line.discount_fixed and not line.discount">
                                    <span t-esc="'{0:,.2f}'.format(abs(float(line.discount_fixed)))"/>
                                </t>
                                <t t-if="line.discount and not line.discount_fixed">
                                    <span t-esc="'{0:,.0f}'.format(abs(float(line.discount)))"/>%
                                </t>
                                <t t-if="not line.discount and not line.discount_fixed">
                                    0
                                </t>
                            </t>
                        </td>

                        <td class="text-right">
                            <span t-field="line.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                        </td>
                    </t>
                    <t t-if="line.display_type == 'line_section'">
                        <td colspan="99" id="section">
                            <span t-field="line.name"/>
                        </td>
                        <t t-set="current_section" t-value="line"/>
                        <t t-set="current_subtotal" t-value="0"/>
                    </t>
                    <t t-if="line.display_type == 'line_note'">
                        <td colspan="99" id="note">
                            <span t-field="line.name"/>
                        </td>
                    </t>
                </tr>
                <t t-if="current_section and (line_last or o.order_line[line_index+1].display_type == 'line_section')">
                    <tr class="is-subtotal text-right">
                        <td colspan="99" id="subtotal">
                            <strong class="mr16">Subtotal</strong>
                            <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                        </td>
                    </tr>
                </t>
            </t>

        </xpath>

        <xpath expr="//div[3]/div" position="replace">
            <div class="col-4">
                <table class="table table-sm">
                    <!--<t t-set="tax_totals" t-value="json.loads(o.tax_totals_json)"/>-->
                    <!--<t t-call="account.document_tax_totals"/>-->
                    <!--<span>sss</span>-->
                    <tr>
                        <td>
                            <span>Untaxed Amount </span>
                        </td>
                        <td align="right">
                            <span t-field="o.amount_untaxed"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Discount</span>
                        </td>
                        <td align="right">
                            <span t-field="o.discounted_amount"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>VAT 7%</span>
                        </td>
                        <td align="right">
                            <span t-field="o.amount_tax"/>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Total </span>
                        </td>
                        <td align="right">
                            <span t-field="o.amount_total"/>
                        </td>
                    </tr>
                </table>
            </div>


        </xpath>

        <xpath expr="//div[1]" position="replace">
            <!--            <div t-field="o.partner_id"/>-->
            <div>
                <span t-field="o.partner_id.name"/><br/>
                <span t-field="o.partner_id.street"/>
                <span t-field="o.partner_id.street2"/>
                <span t-field="o.partner_id.district_id.name"/>
                <span t-field="o.partner_id.state_id.name"/>
                <span t-field="o.partner_id.zip"/><br/>
                <span t-field="o.partner_id.country_id.name"/><br/>
                <img src="/itaas_print_purchase_report/static/call.png" class="bi bi-telephone-fill primary" style=" background-size:4mm 4mm; width:3mm; height:3mm;"/>

<!--                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 20 20">-->
<!--                    <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>-->
<!--                </svg>-->
                <span t-field="o.partner_id.phone" t-options="{ &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>

            </div>

            <!--                 t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>-->


        </xpath>



    </template>
</odoo>
